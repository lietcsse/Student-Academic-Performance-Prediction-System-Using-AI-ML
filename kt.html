
<!doctype html>

<html lang="en"> 

 <head> 

  <meta charset="UTF-8"> 

  <title>KT Form </title> 

  <link rel="stylesheet" href="kt.css"> 

 </head> 

 <body> <!-- partial:index.partial.html --> 

  <section> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> 

    <div class="signin"> 

        <div class="content"> 
    
         <h2>Q] Select all the subjects in which you have backlogs? </h2> 
    
         <div class="form"> 
    
    
        </div> 
    
       </div> 
    
    </div>

    <div class="signin1">
    <select name="language[]" class="custom-select" multiple>
      <option value="Engineering maths 1">Maths 1</option>
      <option value="Engineering Physics 1">Physics 1</option>
      <option value="Engineering Chemistry 1">Chemistry 1</option>
      <option value="Engineering Mechanics">Mechanics</option>
      <option value="basic engineering electronics">BEE</option>
    </select>
    <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 1</h2></div>
 </div>

 <div class="signin2">
  <select name="language[]" class="custom-select" multiple>
    <option value="Engineering maths 2">Maths 2</option>
    <option value="Engineering Physics 2">Physics 2</option>
    <option value="Professional communication ethics">PCE</option>
    <option value="Engineering Graphics">Eng Graphics</option>
    <option value="Engineering Chemistry 2">Chemistry 2</option>
  </select>
  <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 2</h2></div>
</div>

<div class="signin3">
  <select name="language[]" class="custom-select" multiple>
    <option value="Engineering maths 3">Maths 3</option>
    <option value="Digital Logic and Computer Architecture">DLCA</option>
    <option value="Computer Graphics">CG</option>
    <option value="Data structure and algorithms">Data structures</option>
    <option value="Descrete Maths">DSGT</option>
  </select>
  <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 3</h2></div>
</div>

<div class="signin4">
  <select name="language[]" class="custom-select" multiple>
    <option value="Engineering maths 3">Maths 4</option>
    <option value="Analysis of Algorithms">AOA</option>
    <option value="Database Managment System">DBMS</option>
    <option value="Microprocessor">Microprocessor</option>
    <option value="Operating System">OS</option>
  </select>
  <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 4</h2></div>
</div>

<div class="signin5">
  <select name="language[]" class="custom-select" multiple>
    <option value="Artificial Intelligence">AI</option>
    <option value="Business Communication and ethics">BCE</option>
    <option value="Data Warehouse and mining">DWM</option>
    <option value="Computer Network">Computer Network</option>
    <option value="Web Computing">Web Computing</option>
  </select>
  <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 5</h2></div>
</div>

<div class="signin6">
  <select name="language[]" class="custom-select" multiple>
    <option value="Data Analytics and Visulization">DAV</option>
    <option value="Crytography">Crytography</option>
    <option value="Software Engineering and Project Management">SEPM</option>
    <option value="Machine Learning">ML</option>
    <option value="Operating System"></option>
  </select>
  <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 6</h2></div>
</div>

<div class="signin7">
  <select name="language[]" class="custom-select" multiple>
    <option value="Engineering maths 4">Maths 4</option>
    <option value="Analysis of Algorithms">AOA</option>
    <option value="Database Managment System">DBMS</option>
    <option value="Microprocessor">Microprocessor</option>
    <option value="Operating System">OS</option>
  </select>
  <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 7</h2></div>
</div>

<div class="signin8">
  <select name="language[]" class="custom-select" multiple>
    <option value="Engineering maths 3">Maths 4</option>
    <option value="Analysis of Algorithms">AOA</option>
    <option value="Database Managment System">DBMS</option>
    <option value="Microprocessor">Microprocessor</option>
    <option value="Operating System">OS</option>
  </select>
  <div class="move">
    <h2 style="color: #fff; text-align:center; ">SEM 8</h2></div>
</div>
   

    <script src="kt.js"></script>


    <!-- Submit button -->
    <div class="signin9"> 

      <div class="content9"> 
    
       <div class="form9"> 
    
        <div class="inputBox9"> 
           
          <a href="">
         <input type="submit" value="SUBMIT" id="submit-button"> 
        </a>
        
        </div> 
    
       </div> 
    
      </div> 
    
     </div>
    <!-- Submit buttton -->
  </section> <!-- partial --> 

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-analytics.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
    import { getFirestore, collection, setDoc,doc, updateDoc,getDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
    

    const firebaseConfig = {
  apiKey: "AIzaSyDuDxckSsWSJI3nsIpESKSfmdBNnRId0-w",
  authDomain: "student-performance-de2c7.firebaseapp.com",
  projectId: "student-performance-de2c7",
  storageBucket: "student-performance-de2c7.firebasestorage.app",
  messagingSenderId: "387224762479",
  appId: "1:387224762479:web:723bc6d63e9373a83df59a",
  measurementId: "G-QYYEDCDY7Z"
};
  

    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const db = getFirestore(app);

      // Function to show only valid semester cards based on current semester
     const showValidSemesterCards = async () => {
        const user = auth.currentUser;
        
        if (!user) {
            console.log("No user signed in");
            return;
        }

        try {
            // Get the current semester from Firestore
            const userDocRef = doc(db, 'users', user.uid);
            const userDocSnap = await getDoc(userDocRef);

            if (userDocSnap.exists()) {
                const userData = userDocSnap.data();
                const currentSemester = userData.semester;

                // Hide all semester cards
                for (let i = 1; i <= 8; i++) {
                    document.querySelector(`.signin${i}`).style.display = "none";
                }

                // Show valid semester cards based on current semester
                if (currentSemester > 8) {
            let i;
            if (currentSemester % 2 === 0) {
                i = currentSemester - 3;
            } else {
                i = currentSemester - 2;
            }
            for (; i < currentSemester; i++) {
                document.querySelector(`.signin${i}`).style.display = "block";
            }
        } else {
            // If current semester is 4 or less, iterate from 1 to current semester
            for (let i = 1; i < currentSemester; i++) {
                document.querySelector(`.signin${i}`).style.display = "block";
            }
        }
    } else {
        console.log("User document does not exist");
    }
} catch (error) {
    console.error('Error retrieving user data:', error.message);
}
    };
   
    const submitForm = async () => {
       event.preventDefault();
       const user = auth.currentUser;

        if (!user) {
            console.log("No user signed in");
            return;
        }

          // Array to store selected subjects
    const selectedSubjects = [];

// Loop through each semester
for (let i = 1; i <= 8; i++) {
  // Get the selected subjects for the current semester
  const semesterSelect = document.querySelector(`.signin${i} select`);
  const selectedOptions = [...semesterSelect.selectedOptions].map(option => option.value);

  // Add the selected subjects to the array
  selectedSubjects.push({
    semester: `SEM ${i}`,
    subjects: selectedOptions
  });
}
   

      try {
           
            const userDocRef = doc(db, 'users', user.uid);
            await updateDoc(userDocRef, {
              selectedSubjects: selectedSubjects
            });
                sendUserIdToBackend(user.uid);
                window.location.href = `http://127.0.0.1:5000/kt_output/${user.uid}`;
        } catch (error) {
            console.error('User input error:', error.message);
            alert('Error: ' + error.message);
        }
    };


    const sendUserIdToBackend = async (userId) => {
        try {
            const response = await fetch('http://127.0.0.1:5000/user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId }),
            });

            if (response.ok) {
                console.log('User ID sent to backend successfully');
            } else {
                console.error('Failed to send user ID to backend');
            }
        } catch (error) {
            console.error('Error sending user ID to backend:', error);
        }
    };


  onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, get the user ID
                showValidSemesterCards();
                // Add event listener to submit button
                document.getElementById('submit-button').addEventListener('click', () => {
                    // Call function to submit form with user ID
                    submitForm();
                });
            } else {
                // No user is signed in
                console.log("No user signed in");
            }
        });

</script>
 </body>

</html>