
<!doctype html>

<html lang="en"> 

 <head> 

  <meta charset="UTF-8"> 

  <title>KT Form </title> 

  <link rel="stylesheet" href="Nonkt.css"> 

 </head> 

 <body> 

  <section> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> 

    <div class="signin"> 

        <div class="content1"> 
    
         <h2>Q] Fill your CGPA according to your Semester's ?</h2> 

       </div> 
    
    </div>

    <!-- Submit button -->

<div class="signin8"> -

  <div class="content8"> 

   <div class="form8"> 

    <div class="inputBox8"> 
       
      <a href="">
     <input type="submit" value="SUBMIT" id="submit-button"> 
    </a>
    
    </div> 

   </div> 

  </div> 

 </div> 
    
   <div class="signin1"> 

    <div class="content"> 

     <h2>SEM 1 CGPA</h2> 

     <div class="form"> 


<form id="sem1Form">


  <div class="inputBox">

    <input type="number" id="sem1" step="0.1" required> <i>( enter your exact CGPA in integers )</i>
</form>

<!-- 2nd sem -->
<div class="signin2"> 

    <div class="content"> 

     <h2>SEM 2 CGPA</h2> 

     <div class="form"> 


<form id="sem2Form">


  <div class="inputBox">

    <input type="number" id="sem2"  step="0.1" required> <i>( enter your exact CGPA in integers )</i>
</form>

<!-- 3rd sem -->
<div class="signin3"> 

    <div class="content"> 

     <h2>SEM 3 CGPA</h2> 

     <div class="form"> 


<form id="sem3Form">


  <div class="inputBox">

    <input type="number" id="sem3" step="0.1" required> <i>( enter your exact CGPA in integers )</i>
</form>

<!-- 4th Sem -->

<div class="signin4"> 

    <div class="content"> 

     <h2>SEM 4 CGPA</h2> 

     <div class="form"> 


<form id="sem4Form">


  <div class="inputBox">

    <input type="number" id="sem4" step="0.1" required> <i>( enter your exact CGPA in integers )</i>
</form>

<!-- 5th sem -->

<div class="signin5"> 

    <div class="content"> 

     <h2>SEM 5 CGPA</h2> 

     <div class="form"> 


<form id="sem5Form">


  <div class="inputBox">

    <input type="number" id="sem5" step="0.1" required> <i>( enter your exact CGPA )</i>
</form>

<!-- 6th Sem -->

<div class="signin6"> 

    <div class="content"> 

     <h2>SEM 6 CGPA</h2> 

     <div class="form"> 


<form id="sem6form">


  <div class="inputBox">

    <input type="number" id="sem6" step="0.1" required> <i>( enter your exact CGPA in integers)</i>
</form>

<!-- 7th sem -->

<div class="signin7"> 

    <div class="content"> 

     <h2>SEM 7 CGPA</h2> 

     <div class="form"> 

<form id="sem7Form">


  <div class="inputBox">

    <input type="number" id="sem7" step="0.1" required> <i>( enter your exact CGPA in integers )</i>
</form>




  </section>
  
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-analytics.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
    import { getFirestore, collection, setDoc,doc, updateDoc,getDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
   
    const firebaseConfig = {
  apiKey: "AIzaSyDuDxckSsWSJI3nsIpESKSfmdBNnRId0-w",
  authDomain: "student-performance-de2c7.firebaseapp.com",
  projectId: "student-performance-de2c7",
  storageBucket: "student-performance-de2c7.firebasestorage.app",
  messagingSenderId: "387224762479",
  appId: "1:387224762479:web:723bc6d63e9373a83df59a",
  measurementId: "G-QYYEDCDY7Z"
};
  

    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const db = getFirestore(app);

      // Function to show only valid semester cards based on current semester
     const showValidSemesterCards = async () => {
        const user = auth.currentUser;
        
        if (!user) {
            console.log("No user signed in");
            return;
        }

        try {
            // Get the current semester from Firestore
            const userDocRef = doc(db, 'users', user.uid);
            const userDocSnap = await getDoc(userDocRef);

            if (userDocSnap.exists()) {
                const userData = userDocSnap.data();
                const currentSemester = userData.semester;

                // Show valid semester cards based on current semester
                for (let i=1; i <= 8; i++) {
                  if(i<currentSemester || i==8){
                    document.querySelector(`.signin${i}`).style.display = "block";
              }else{
                document.querySelector(`.signin${i}`).style.display = "none";
              }
            }
            // document.querySelector('.signin8').style.display = "inline-block";
           
    } else {
        console.log("User document does not exist");
    }
} catch (error) {
    console.error('Error retrieving user data:', error.message);
}
    };

    const submitForm = async () => {
       event.preventDefault();
       const user = auth.currentUser;

        if (!user) {
            console.log("No user signed in");
            return;
        }

        const userId = user.uid;
        sendUserIdToBackend(userId);

          // Array to store cgpa's
    const cgpastored = [];

// Loop through each semester
for (let i = 1; i <= 7; i++) {
  // Get the cgpa for the semesters
  const selectedOptions = document.getElementById(`sem${i}`).value;


  // Add the cgpa to the array
  cgpastored.push({
    semester: `SEM ${i}`,
    cgpa: selectedOptions
  });
}
   

      try {
           
            const userDocRef = doc(db, 'users', user.uid);
            await updateDoc(userDocRef, {
              Cgpa: cgpastored
            });
           // Optionally, redirect to another page after submission
           window.location.href = `http://127.0.0.1:5000/output/${user.uid}`;
        } catch (error) {
            console.error('User input error:', error.message);
            alert('Error: ' + error.message);
        }
    };

    const sendUserIdToBackend = async (userId) => {
        try {
            const response = await fetch('http://127.0.0.1:5000/cgpa', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId }),
            });

            if (response.ok) {
                console.log('User ID sent to backend successfully');
            } else {
                console.error('Failed to send user ID to backend');
            }
        } catch (error) {
            console.error('Error sending user ID to backend:', error);
        }
    };

    onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, get the user ID
                showValidSemesterCards();
                // Add event listener to submit button
                document.getElementById('submit-button').addEventListener('click', () => {
                    // Call function to submit form with user ID
                    submitForm();
                });
            } else {
                // No user is signed in
                console.log("No user signed in");
            }
        });
  </script>
  </body>
  </html>